<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>On the usage and estimation of theta in DImulti() • DImodelsMulti</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="On the usage and estimation of theta in DImulti()">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">DImodelsMulti</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/DImulti_workflow.html">The recommended workflow of DImulti() analyses</a></li>
    <li><a class="dropdown-item" href="../articles/DImulti_onTheta.html">On the usage and estimation of theta in DImulti()</a></li>
    <li><a class="dropdown-item" href="../articles/DImulti_prediction.html">On prediction from multivariate repeated measures DI models</a></li>
    <li><a class="dropdown-item" href="../articles/DImulti_commonErrors.html">Common errors &amp; warnings encountered in DImulti()</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/DI-LauraByrne/DImodelsMulti/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>On the usage and estimation of theta in DImulti()</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/DI-LauraByrne/DImodelsMulti/blob/master/vignettes/DImulti_onTheta.Rmd" class="external-link"><code>vignettes/DImulti_onTheta.Rmd</code></a></small>
      <div class="d-none name"><code>DImulti_onTheta.Rmd</code></div>
    </div>

    
    
<style type="text/css">
span.R {
  font-family: Courier New;
}
</style>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dimodels.com" class="external-link">DImodelsMulti</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dimodels.com/" class="external-link">DImodels</a></span><span class="op">)</span></span></code></pre></div>
<h2>
A quick overview
</h2>
<p>The main function of the R package <span class="R">DImodelsMulti</span> is <span class="R">DImulti()</span>. It
is designed to fit (1) multivariate Diversity-Interactions (DI) models
(Dooley <em>et al.</em>, 2015), (2) repeated measures DI models (Finn
<em>et al.</em>, 2013), and (3) multivariate repeated measures DI
models.</p>
<p>An example of a multivariate repeated measures DI model can be seen
below:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mi>k</mi><mi>m</mi><mi>t</mi></mrow></msub><mo>=</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>S</mi></munderover><mrow><msub><mi>β</mi><mrow><mi>i</mi><mi>k</mi><mi>t</mi></mrow></msub><msub><mi>p</mi><mrow><mi>i</mi><mi>m</mi></mrow></msub></mrow><mo>+</mo><munderover><mo>∑</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mrow><mi>i</mi><mo>,</mo><mi>j</mi><mo>=</mo><mn>1</mn></mrow></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mrow><mi>i</mi><mo>&lt;</mo><mi>j</mi></mrow></mtd></mtr></mtable><mi>S</mi></munderover><mrow><msub><mi>δ</mi><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mi>t</mi></mrow></msub><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>p</mi><mrow><mi>i</mi><mi>m</mi></mrow></msub><msub><mi>p</mi><mrow><mi>j</mi><mi>m</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>θ</mi><mi>k</mi></msub></msup></mrow><mo>+</mo><msub><mi>ϵ</mi><mrow><mi>k</mi><mi>m</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex"> y_{kmt} =  \sum^{S}_{i=1}{\beta_{ikt} p_{im}} +
 \sum^{S}_{\substack{i,j=1 \\ i&lt;j}}{\delta_{ijkt}(p_{im}p_{jm})^{\theta_{k}}} +
 \epsilon_{kmt} </annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mrow><mi>k</mi><mi>m</mi><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">y_{kmt}</annotation></semantics></math>
refers to the value of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>k</mi><mrow><mi>t</mi><mi>h</mi></mrow></msup><annotation encoding="application/x-tex">k^{th}</annotation></semantics></math>
ecosystem function from the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>m</mi><mrow><mi>t</mi><mi>h</mi></mrow></msup><annotation encoding="application/x-tex">m^{th}</annotation></semantics></math>
experimental unit at a time point
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>.
For an experimental unit
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>m</mi><annotation encoding="application/x-tex">m</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mrow><mi>i</mi><mi>k</mi><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">\beta_{ikt}</annotation></semantics></math>
scaled by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mrow><mi>i</mi><mi>m</mi></mrow></msub><annotation encoding="application/x-tex">p_{im}</annotation></semantics></math>
is the expected contribution of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>i</mi><mrow><mi>t</mi><mi>h</mi></mrow></msup><annotation encoding="application/x-tex">i^{th}</annotation></semantics></math>
species to the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>k</mi><mrow><mi>t</mi><mi>h</mi></mrow></msup><annotation encoding="application/x-tex">k^{th}</annotation></semantics></math>
response at time point
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
and is referred to as the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>i</mi><mrow><mi>t</mi><mi>h</mi></mrow></msup><annotation encoding="application/x-tex">i^{th}</annotation></semantics></math>
species’ ID effect.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>S</mi><annotation encoding="application/x-tex">S</annotation></semantics></math>
represents the number of unique species present in the study. Similarly
to the ID effect, the interaction effect,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>δ</mi><annotation encoding="application/x-tex">\delta</annotation></semantics></math>,
between species is scaled by some combination of the products of species
proportions, which depends on the interaction structure chosen. The
example above shows the full pairwise structure, which has a unique
interaction term,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>δ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\delta_{ij}</annotation></semantics></math>,
per pair of species
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
&amp;
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>.</p>
<p>The nonlinear term
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
(Connolly <em>et al.</em>, 2013; Vishwakarma <em>et al.</em>, 2023), the
focus of this vignette, is applied as a power to each pair of species
proportions included in the interaction terms of the model. It is
included in the model to allow the shape of the BEF relationship to
change. The value of the nonlinear parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
is allowed to vary between ecosystem functions, in turn allowing the
fixed effect structure to change across functions, in recognition that
the nature of the species interactions could change between ecosystem
functions.</p>
<p><img src="Theta.png" style="width:100.0%" alt="A figure showing how the DI model fits to the data with varying values of theta">
Image Credit: Connolly <em>et al.</em> 2013</p>
<h2>
DImulti()’s estimation process for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
</h2>
<p>In the function <span class="R">DImulti()</span>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
values may be supplied by a user through the parameter <span class="R">‘theta’</span> or estimated by specifying <span class="R">TRUE</span> through <span class="R">‘estimate_theta’</span>.
The non-linear term may also be “left out” by setting <span class="R">‘theta’</span> equal to 1 and <span class="R">‘estimate_theta’</span> to FALSE, which is the default for the
function.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/DImulti.html">DImulti</a></span><span class="op">(</span><span class="va">...</span>, theta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">1.2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/DImulti.html">DImulti</a></span><span class="op">(</span><span class="va">...</span>, theta <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>Setting a value for theta supplied by a user is a straightforward
process thanks to the function <span class="R">DI_data()</span> from the
parent package <span class="R">DImodels</span> (Moral <em>et al.</em>,
2023). We divide the dataset by ecosystem function, as multivariate data
can have differing values of theta for each, then pass each subset into
the function, specifying the desired
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
value and base interaction structure. The subsets are then bound
together again and the dataset is ready for use with theta.</p>
<p>The below example would transform the usual format of a full pairwise
structure from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>δ</mi><mn>12</mn></msub><msub><mi>p</mi><mn>1</mn></msub><msub><mi>p</mi><mn>2</mn></msub><mo>+</mo><msub><mi>δ</mi><mn>13</mn></msub><msub><mi>p</mi><mn>1</mn></msub><msub><mi>p</mi><mn>3</mn></msub><mo>+</mo><msub><mi>δ</mi><mn>23</mn></msub><msub><mi>p</mi><mn>2</mn></msub><msub><mi>p</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">\delta_{12}p_{1}p_{2} + \delta_{13}p_{1}p_{3} + \delta_{23}p_{2}p_{3}</annotation></semantics></math>
to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>δ</mi><mn>12</mn></msub><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>p</mi><mn>1</mn></msub><msub><mi>p</mi><mn>2</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>1.2</mn></msup><mo>+</mo><msub><mi>δ</mi><mn>13</mn></msub><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>p</mi><mn>1</mn></msub><msub><mi>p</mi><mn>3</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>1.2</mn></msup><mo>+</mo><msub><mi>δ</mi><mn>23</mn></msub><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>p</mi><mn>2</mn></msub><msub><mi>p</mi><mn>3</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>1.2</mn></msup></mrow><annotation encoding="application/x-tex">\delta_{12}(p_{1}p_{2})^{1.2} + \delta_{13}(p_{1}p_{3})^{1.2} + \delta_{23}(p_{2}p_{3})^{1.2}</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/DImodels/man/DI_data_manipulation.html" class="external-link">DI_data</a></span><span class="op">(</span><span class="va">...</span>, theta <span class="op">=</span> <span class="fl">1.2</span>, what <span class="op">=</span> <span class="st">"FULL"</span><span class="op">)</span></span></code></pre></div>
<p>When theta is estimated, the process is a bit more involved. We
create a function to fit multivariate repeated measures DI models,
wrapping <span class="R">DImulti()</span>, which accepts a vector of
theta values, one per ecosystem function, and returns the negative log
likelihood of the produced model. We then use <span class="R">optim()</span> to minimise the returned value from this
function over the space of the allowable values of theta (0.1 to
1.5).</p>
<p>After fitting a model where theta is estimated. This model should
then be compared to a model with the same fixed effects structure using
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\theta = 1</annotation></semantics></math>
using information criteria (AIC, BIC, AICc, BICc) to test the
significance of the estimated values. This may be done all at once, as
below:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/AICc.html">AICc</a></span><span class="op">(</span><span class="va">DImodel</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/AICc.html">AICc</a></span><span class="op">(</span><span class="va">DImodel_theta</span><span class="op">)</span></span></code></pre></div>
<p>Or each value of theta should be tested individually while the others
are held constant at a value of 1.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/AICc.html">AICc</a></span><span class="op">(</span><span class="va">DImodel</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/AICc.html">AICc</a></span><span class="op">(</span><span class="va">DImodel_thetaFunc1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/AICc.html">AICc</a></span><span class="op">(</span><span class="va">DImodel</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/AICc.html">AICc</a></span><span class="op">(</span><span class="va">DImodel_thetaFunc2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/AICc.html">AICc</a></span><span class="op">(</span><span class="va">DImodel</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/AICc.html">AICc</a></span><span class="op">(</span><span class="va">DImodel_thetaFunc3</span><span class="op">)</span></span></code></pre></div>
<p>The best method for estimating and testing theta values has not yet
been thoroughly tested.</p>
<p>In the event that the preferred model has an estimated value of theta
that differs from 1 but causes fitting issues, e.g., predictions are
unrealistic, either in the model used for estimation or a final selected
model, set the theta value equal to 1 and continue/redo the
analysis.</p>
<h2>
Implications of this methodology
</h2>
<p>The methodology used in this package allows a user to estimate the
value of theta for each ecosystem function in the dataset one-by-one
(single), simultaneously (joint) or ignoring response correlations
(univariate) using log-likelihood as a measure of model fit quality.</p>
<p>For multivariate and repeated measures DI models, we have allowed the
value of theta to vary across ecosystem functions, which in turn allows
the change in fixed effects structures to vary across functions. This is
not common practice in multivariate regression and so its
effects/implications will require further study.</p>
<p>The methodology used in this R package may change in future updates
to align with research findings on the topic.</p>
<h2>
References
</h2>
<p>Vishwakarma, R., Byrne, L., Connolly, J., de Andrade Moral, R. and
Brophy, C., 2023. Estimation of the non-linear parameter in Generalised
Diversity-Interactions models is unaffected by change in structure of
the interaction terms. Environmental and Ecological Statistics, 30(3),
pp.555-574.</p>
<p>Moral, R.A., Vishwakarma, R., Connolly, J., Byrne, L., Hurley, C.,
Finn, J.A. and Brophy, C., 2023. Going beyond richness: Modelling the
BEF relationship using species identity, evenness, richness and species
interactions via the DImodels R package. Methods in Ecology and
Evolution, 14(9), pp.2250-2258.</p>
<p>Dooley, Á., Isbell, F., Kirwan, L., Connolly, J., Finn, J.A. and
Brophy, C., 2015. Testing the effects of diversity on ecosystem
multifunctionality using a multivariate model. Ecology Letters, 18(11),
pp.1242-1251.</p>
<p>Finn, J.A., Kirwan, L., Connolly, J., Sebastià, M.T., Helgadottir,
A., Baadshaug, O.H., Bélanger, G., Black, A., Brophy, C., Collins, R.P.
and Čop, J., 2013. Ecosystem function enhanced by combining four
functional types of plant species in intensively managed grassland
mixtures: a 3‐year continental‐scale field experiment. Journal of
Applied Ecology, 50(2), pp.365-375 .</p>
<p>Connolly, J., Bell, T., Bolger, T., Brophy, C., Carnus, T., Finn,
J.A., Kirwan, L., Isbell, F., Levine, J., Lüscher, A. and Picasso, V.,
2013. An improved model to predict the effects of changing biodiversity
levels on ecosystem function.</p>
<p>Journal of Ecology, 101(2), pp.344-355.</p>
<p>Kirwan, L., Connolly, J., Finn, J.A., Brophy, C., Lüscher, A.,
Nyfeler, D. and Sebastià, M.T., 2009. Diversity-interaction modeling:
estimating contributions of species identities and interactions to
ecosystem function. Ecology, 90(8), pp.2032-2038.</p>
<p>Brent, R.P., 1973. Some efficient algorithms for solving systems of
nonlinear equations. SIAM Journal on Numerical Analysis, 10(2),
pp.327-344.</p>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Laura Byrne, Rishabh Vishwakarma, Rafael de Andrade Moral, Caroline Brophy.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
